{% extends "App/base.html" %}
{% load static %}
{% comment %} trade_form.html {% endcomment %}
{% block title %}{% if is_update %}Edit Trade{% else %}Add New Trade{% endif %}{% endblock %}
{% block extra_head %}
    <!-- Select2 for enhanced stock selection -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'trades/css/trade_form.css'%}">
{% endblock %}
{% block content %}
<div class="trade-modal">
    <h4 class="fw-bold mb-3">{% if is_update %}Edit Trade{% else %}Add New Trade{% endif %}</h4>
    <form method="post" action="">
        {% csrf_token %}
        
        <!-- Display form errors if any -->
        {% if form.non_field_errors %}
            <div class="alert alert-danger mb-3">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        
        <!-- BASIC TRADE INFO -->
        <div class="row g-3 mb-3">
            <div class="col-md-4">
                <label class="form-label" for="{{ form.stock.id_for_label }}">Stock Symbol <span style="color:#1d4ed8">*</span></label>
                {{ form.stock }}
                {% if form.stock.errors %}
                    <div class="text-danger small">{{ form.stock.errors }}</div>
                {% endif %}
            </div>
            <div class="col-md-4">
                <label class="form-label" for="{{ form.quantity.id_for_label }}">Quantity <span style="color:#1d4ed8">*</span></label>
                {{ form.quantity }}
                {% if form.quantity.errors %}
                    <div class="text-danger small">{{ form.quantity.errors }}</div>
                {% endif %}
            </div>
            <div class="col-md-4">
                <label class="form-label" for="{{ form.buying_price.id_for_label }}">Buying Price <span style="color:#1d4ed8">*</span></label>
                {{ form.buying_price }}
                {% if form.buying_price.errors %}
                    <div class="text-danger small">{{ form.buying_price.errors }}</div>
                {% endif %}
            </div>
        </div>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label" for="{{ form.buy_date.id_for_label }}">Buy Date <span style="color:#1d4ed8">*</span></label>
                {{ form.buy_date }}
                {% if form.buy_date.errors %}
                    <div class="text-danger small">{{ form.buy_date.errors }}</div>
                {% endif %}
            </div>
            <div class="col-md-3">
                <label class="form-label" for="{{ form.mtp.id_for_label }}">MTP</label>
                {{ form.mtp }}
                {% if form.mtp.errors %}
                    <div class="text-danger small">{{ form.mtp.errors }}</div>
                {% endif %}
            </div>
            <div class="col-md-3">
                <label class="form-label" for="{{ form.msl.id_for_label }}">MSL</label>
                {{ form.msl }}
                {% if form.msl.errors %}
                    <div class="text-danger small">{{ form.msl.errors }}</div>
                {% endif %}
            </div>
        </div>
        <!-- PROFIT / LOSS METRICS -->
        <div class="summary-box mb-4">
            <h6 class="fw-bold mb-3">Profit &amp; Loss Metrics</h6>
            <div class="row g-3 mb-2">
                <div class="col-md-4 summary-item">
                    <label for="id_profit_expected">Profit Expected</label>
                    <input type="text" class="form-control" name="profit_expected" id="id_profit_expected" readonly>
                </div>
                <div class="col-md-4 summary-item">
                    <label for="id_profit_percent">Profit %</label>
                    <input type="text" class="form-control" name="profit_percent" id="id_profit_percent" readonly>
                </div>
                <div class="col-md-4 summary-item">
                    <label for="id_loss_expected">Loss Expected</label>
                    <input type="text" class="form-control" name="loss_expected" id="id_loss_expected" readonly>
                </div>
            </div>
            <div class="row g-3 mb-2">
                <div class="col-md-4 summary-item">
                    <label for="id_loss_recent">Recent Loss</label>
                    <input type="text" class="form-control" name="loss_recent" id="id_loss_recent" readonly>
                </div>
                <div class="col-md-4 summary-item">
                    <label for="id_pl_ratio">P/L Ratio</label>
                    <input type="text" class="form-control" name="pl_ratio" id="id_pl_ratio" readonly>
                </div>
                <div class="col-md-4 summary-item">
                    <label for="id_rate_difference">Rate Difference</label>
                    <input type="text" class="form-control" name="rate_difference" id="id_rate_difference" readonly>
                </div>
            </div>
            <div class="row g-3">
                <div class="col-md-4 summary-item">
                    <label for="id_pl_percent">P/L Percent</label>
                    <input type="text" class="form-control" name="pl_percent" id="id_pl_percent" readonly>
                </div>
                <div class="col-md-4 summary-item">
                    <label for="id_max_profit">Max Profit</label>
                    <input type="text" class="form-control" name="max_profit" id="id_max_profit" readonly>
                </div>
                <div class="col-md-4 summary-item">
                    <label for="id_min_profit_loss">Min Profit / Loss</label>
                    <input type="text" class="form-control" name="min_profit_loss" id="id_min_profit_loss" readonly>
                </div>
            </div>
        </div>
        <!-- COMMENTS -->
        <div class="mb-4">
            <label class="form-label" for="{{ form.comments.id_for_label }}">Comments</label>
            {{ form.comments }}
            {% if form.comments.errors %}
                <div class="text-danger small">{{ form.comments.errors }}</div>
            {% endif %}
        </div>
        <!-- ACTION BUTTONS -->
        <div class="d-flex gap-3">
            <button type="submit" class="btn btn-primary btn-primary-custom">
                <i class="fa-solid fa-{% if is_update %}save{% else %}plus{% endif %} me-2"></i> {% if is_update %}Update Trade{% else %}Add Trade{% endif %}
            </button>
            <a href="{% url 'portfolio_dashboard' %}" class="btn btn-cancel w-100">Cancel</a>
        </div>
    </form>
</div>

{% endblock %}
{% block extra_body %}
<!-- jQuery and Select2 for enhanced stock selection (UI enhancement only, not required for form submission) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(document).ready(function() {
        // Initialize Select2 on stock select field (UI enhancement only)
        $('#id_stock').select2({
            theme: 'bootstrap-5',
            placeholder: 'Select stock',
            allowClear: true,
            width: '100%'
        });
    });
</script>
{% endblock %}
