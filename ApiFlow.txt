Bilkul â€” neeche **end-to-end working flow** step-by-step explain kiya gaya hai:
**browser se le kar PSX API tak**, phir **wapas template update** tak.
Main har step me **kaunsi file**, **kaunsa function**, aur **kis order me** cheez run hoti hai clearly bata raha hoon.

---

# ğŸ“Œ Overall Big Picture (High Level)

```
User (Browser)
   â†“
stock_form.html (JS)
   â†“
Django URL â†’ View
   â†“
Service (PSX API)
   â†“
View â†’ JSON
   â†“
Browser  
   â†“
Form field auto-fill
```

Ab isko **detail me** samajhte hain.

---

## 1ï¸âƒ£ User Browser me kya karta hai?

ğŸ“„ **File:** `stock_form.html`

User yeh karta hai:

* Stock Symbol input me `GAL` likhta hai
* Input se bahar click karta hai (blur / change event)

```html
<input type="text" id="id_symbol">
```

â¡ï¸ Ab **JavaScript active hota hai**

ğŸ“˜ Source (DOM Events â€“ MDN):
[https://developer.mozilla.org/en-US/docs/Web/API/Element/blur_event](https://developer.mozilla.org/en-US/docs/Web/API/Element/blur_event)

---

## 2ï¸âƒ£ JavaScript event trigger hota hai

ğŸ“„ **File:** `stock_form.html` (inline `<script>`)

```js
symbolInput.addEventListener("blur", handleSymbolChange);
symbolInput.addEventListener("change", handleSymbolChange);
```

### JS kya karta hai?

1. Symbol ko uppercase karta hai
2. Django backend ko AJAX request bhejta hai

```js
fetch(`/stocks/fetch/?symbol=GAL`)
```

ğŸ“Œ Yeh **HTTP GET request** hai

ğŸ“˜ Source (Fetch API â€“ MDN):
[https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)

---

## 3ï¸âƒ£ Browser â†’ Django URL routing

ğŸ“„ **File:** `urls.py`

```python
path("stocks/fetch/", fetch_stock_price_ajax, name="fetch_stock_price")
```

ğŸ”¹ Django:

* URL match karta hai
* Control **fetch_stock_price_ajax** view ko deta hai

ğŸ“˜ Source (Django URL Dispatcher):
[https://docs.djangoproject.com/en/stable/topics/http/urls/](https://docs.djangoproject.com/en/stable/topics/http/urls/)

---

## 4ï¸âƒ£ Django View run hota hai

ğŸ“„ **File:** `views.py`

```python
@login_required
def fetch_stock_price_ajax(request):
    symbol = request.GET.get("symbol")
```

### View ka kaam:

* URL se `symbol=GAL` read karta hai
* Service function ko call karta hai

```python
data = fetch_stock_from_psx(symbol)
```

ğŸ“˜ Source (Django Views):
[https://docs.djangoproject.com/en/stable/topics/http/views/](https://docs.djangoproject.com/en/stable/topics/http/views/)

---

## 5ï¸âƒ£ Service layer (External API call)

ğŸ“„ **File:** `services.py`

```python
def fetch_stock_from_psx(symbol):
    url = f"https://psxterminal.com/api/ticks/REG/{symbol}"
```

### Yahan kya hota hai?

* Django **PSX Terminal API** ko request bhejta hai
* Response JSON receive hota hai

```json
{
  "success": true,
  "data": {
    "price": 546.78,
    "high": 552.5,
    "low": 544.5
  }
}
```

### Service kya karta hai?

* JSON validate karta hai
* Sirf required fields extract karta hai
* Python dictionary return karta hai

ğŸ“˜ Source (Requests library):
[https://requests.readthedocs.io/en/latest/user/quickstart/](https://requests.readthedocs.io/en/latest/user/quickstart/)

---

## 6ï¸âƒ£ Service â†’ View wapas aata hai

ğŸ“„ **File:** `views.py`

```python
return JsonResponse({
    "price": float(data["price"]),
    "high": float(data["high"]),
    "low": float(data["low"]),
})
```

ğŸ“Œ Django ab **JSON response** browser ko bhej deta hai

ğŸ“˜ Source (JsonResponse):
[https://docs.djangoproject.com/en/stable/ref/request-response/#jsonresponse](https://docs.djangoproject.com/en/stable/ref/request-response/#jsonresponse)

---

## 7ï¸âƒ£ Browser ko JSON milta hai

ğŸ“„ **File:** `stock_form.html` (JS)

```js
const data = await response.json();
priceInput.value = data.price.toFixed(2);
```

### JS kya karta hai?

* `current_price` input ko update karta hai
* High / Low fields bhi fill karta hai

ğŸ“Œ **Page reload nahi hota** (AJAX magic âœ¨)

ğŸ“˜ Source (Asynchronous JS):
[https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous)

---

## 8ï¸âƒ£ User Form submit karta hai

ğŸ“„ **File:** `stock_form.html`

```html
<form method="post">
```

### Django backend me:

ğŸ“„ **views.py**

```python
def stock_create_view(request):
    form = StockForm(request.POST)
```

* Form data validate hota hai
* Backend **dobara PSX API call karta hai** (safety ke liye)
* Stock save hota hai

ğŸ“˜ Source (ModelForm save):
[https://docs.djangoproject.com/en/stable/topics/forms/modelforms/](https://docs.djangoproject.com/en/stable/topics/forms/modelforms/)

---

## 9ï¸âƒ£ Database me data save hota hai

ğŸ“„ **File:** `models.py`

```python
class Stock(models.Model):
    current_price = models.DecimalField(...)
```

ğŸ“Œ Ab stock permanently database me save ho chuka hota hai.

ğŸ“˜ Source (Django ORM):
[https://docs.djangoproject.com/en/stable/topics/db/models/](https://docs.djangoproject.com/en/stable/topics/db/models/)

---

# ğŸ” Complete Flow Summary (One Line)

> **User types symbol â†’ JS sends AJAX â†’ Django URL â†’ View â†’ Service â†’ PSX API â†’ JSON â†’ JS fills price â†’ User submits â†’ Django saves stock**

---

## âœ… Why This Architecture is Correct

âœ” Separation of concerns
âœ” Service layer for APIs
âœ” AJAX for UX
âœ” Backend validation safety

ğŸ“˜ Django design philosophy:
[https://docs.djangoproject.com/en/stable/misc/design-philosophies/](https://docs.djangoproject.com/en/stable/misc/design-philosophies/)

---

Agar tum chaho to next:

* main **diagram bana deta hoon**
* ya **debugging flow sikha doon**
* ya **same flow Trades ke liye explain kar doon**
* ya **HTMX version dikha doon**

Bas batao ğŸ‘
